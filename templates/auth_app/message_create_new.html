{% extends 'auth_app/base.html' %}
{% block page_title %}Yangi murojaat{% endblock %}
{% block content %}
<div class="message-create-page">
  <div class="container-fluid px-3 px-md-4">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="h3 mb-0 text-dark">Yangi murojaat</h2>
          <a href="{% url 'message_list' %}" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left me-2"></i>Orqaga
          </a>
        </div>

        <!-- Form Card -->
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
              <i class="fas fa-edit me-2"></i>Murojaat yozish
            </h5>
          </div>
          <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
              {% csrf_token %}
              
              <!-- Subject Field -->
              <div class="mb-4">
                <label for="{{ form.subject.id_for_label }}" class="form-label fw-bold">
                  <i class="fas fa-heading me-2 text-muted"></i>Mavzu
                </label>
                <input type="text" 
                       class="form-control form-control-lg {% if form.subject.errors %}is-invalid{% endif %}" 
                       id="{{ form.subject.id_for_label }}" 
                       name="{{ form.subject.name }}" 
                       value="{{ form.subject.value|default:'' }}"
                       placeholder="Murojaatingiz mavzusini kiriting"
                       required>
                {% if form.subject.errors %}
                  <div class="invalid-feedback">
                    {{ form.subject.errors.0 }}
                  </div>
                {% endif %}
                <div class="form-text">Qisqa va aniq mavzu kiriting</div>
              </div>

              <!-- Responsible Person Field -->
              {% if form.responsible_person %}
              <div class="mb-4">
                <label for="{{ form.responsible_person.id_for_label }}" class="form-label fw-bold">
                  <i class="fas fa-user-tie me-2 text-muted"></i>Mas'ul shaxs
                </label>
                <select class="form-select {% if form.responsible_person.errors %}is-invalid{% endif %}" 
                        id="{{ form.responsible_person.id_for_label }}" 
                        name="{{ form.responsible_person.name }}">
                  <option value="">Mas'ul shaxsni tanlang</option>
                  {% for choice in form.responsible_person %}
                    {{ choice.tag }}
                  {% endfor %}
                </select>
                {% if form.responsible_person.errors %}
                  <div class="invalid-feedback">
                    {{ form.responsible_person.errors.0 }}
                  </div>
                {% endif %}
              </div>
              {% endif %}

              <!-- Content Field -->
              <div class="mb-4">
                <label for="{{ form.content.id_for_label }}" class="form-label fw-bold">
                  <i class="fas fa-comment-alt me-2 text-muted"></i>Murojaat matni
                </label>
                <textarea class="form-control {% if form.content.errors %}is-invalid{% endif %}" 
                          id="{{ form.content.id_for_label }}" 
                          name="{{ form.content.name }}" 
                          rows="6" 
                          placeholder="Murojaatingizni batafsil yozing..."
                          required>{{ form.content.value|default:'' }}</textarea>
                {% if form.content.errors %}
                  <div class="invalid-feedback">
                    {{ form.content.errors.0 }}
                  </div>
                {% endif %}
                <div class="form-text">Muammongizni batafsil tushuntiring</div>
              </div>

              <!-- File Upload Field -->
              {% if form.attachments %}
              <div class="mb-4">
                <label for="{{ form.attachments.id_for_label }}" class="form-label fw-bold">
                  <i class="fas fa-paperclip me-2 text-muted"></i>Fayllar biriktirish
                </label>
                <input type="file" 
                       class="form-control {% if form.attachments.errors %}is-invalid{% endif %}" 
                       id="{{ form.attachments.id_for_label }}" 
                       name="{{ form.attachments.name }}" 
                       multiple 
                       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt">
                {% if form.attachments.errors %}
                  <div class="invalid-feedback">
                    {{ form.attachments.errors.0 }}
                  </div>
                {% endif %}
                <div class="form-text">
                  <i class="fas fa-info-circle me-1"></i>
                  PDF, Word, rasm yoki matn fayllarini biriktirish mumkin (maksimal 5MB)
                </div>
              </div>
              {% endif %}

              <!-- Form Actions -->
              <div class="d-flex flex-column flex-md-row gap-3 mt-4">
                <button type="submit" class="btn btn-primary btn-lg flex-fill">
                  <i class="fas fa-paper-plane me-2"></i>Murojaatni yuborish
                </button>
                <a href="{% url 'message_list' %}" class="btn btn-outline-secondary btn-lg flex-fill">
                  <i class="fas fa-times me-2"></i>Bekor qilish
                </a>
              </div>
            </form>
          </div>
        </div>

        <!-- Help Section -->
        <div class="card mt-4 bg-light">
          <div class="card-body">
            <h6 class="card-title">
              <i class="fas fa-lightbulb text-warning me-2"></i>Foydali maslahatlar:
            </h6>
            <ul class="list-unstyled mb-0 small">
              <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                Aniq va tushunarli mavzu yozing
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                Muammoni batafsil tushuntiring
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success me-2"></i>
                Kerakli hujjatlarni biriktiring
              </li>
              <li>
                <i class="fas fa-check text-success me-2"></i>
                Hurmatli murojaat qiling
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom Styles for Mobile -->
<style>
@media (max-width: 768px) {
  .message-create-page .card-body {
    padding: 1.5rem 1rem;
  }
  
  .message-create-page .btn-lg {
    padding: 0.75rem 1rem;
    font-size: 1rem;
  }
  
  .message-create-page .form-control-lg {
    padding: 0.75rem 1rem;
    font-size: 1rem;
  }
}

@media (max-width: 576px) {
  .message-create-page .container-fluid {
    padding: 0.5rem;
  }
  
  .message-create-page .card {
    border-radius: 0.5rem;
  }
  
  .message-create-page .d-flex.justify-content-between {
    flex-direction: column;
    align-items: flex-start !important;
    gap: 1rem;
  }
}
</style>

<!-- Form Validation Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Bootstrap form validation
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });

  // File input preview
  const fileInput = document.querySelector('input[type="file"]');
  if (fileInput) {
    fileInput.addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      const fileNames = files.map(file => file.name).join(', ');
      if (fileNames) {
        const helpText = this.parentNode.querySelector('.form-text');
        helpText.innerHTML = `<i class="fas fa-check-circle text-success me-1"></i>Tanlangan fayllar: ${fileNames}`;
      }
    });
  }
});
</script>
{% endblock %}
